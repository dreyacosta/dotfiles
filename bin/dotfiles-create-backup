#!/bin/bash

readonly BACKUP_DIR="$HOME/dotfiles-wayback"
readonly TIMESTAMP_DIR="$BACKUP_DIR/$(date +%s)"

target_path="$1"
backup_path="$2"

if [[ ! -e "$target_path" ]]; then
  exit 1
fi

if [[ ! -d "$TIMESTAMP_DIR" ]]; then
  dotfiles-log "Creating timestamped backup directory: $TIMESTAMP_DIR"
  mkdir -p "$TIMESTAMP_DIR"
fi

file_type="file"
[[ -L "$target_path" ]] && file_type="symlink"
[[ -d "$target_path" ]] && file_type="directory"

dotfiles-log "Backing up existing $file_type: $target_path"
mkdir -p "$(dirname "$TIMESTAMP_DIR/$backup_path")"
mv "$target_path" "$TIMESTAMP_DIR/$backup_path"
dotfiles-log "Backup created: $TIMESTAMP_DIR/$backup_path"
